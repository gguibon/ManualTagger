<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta name="description" content=""/>
	<meta name="author" content=""/>

	<title>ManualTagger</title>

	
	
	<!--[if IE]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
      <!-- Bootstrap Core CSS -->
      <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

      <!-- Fonts -->
      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
      <link href="css/animate.css" rel="stylesheet" type="text/css"/>
      <link href="css/style.css" rel="stylesheet" type="text/css"/>
      <link href="css/color.css" rel="stylesheet" type="text/css"/>
      <!-- animsition.css -->
      <link rel="stylesheet" href="css/animsition.min.css">

      <script src="js/jquery.min.js"></script>
      <script type='text/javascript' src='js/modernizr.js'></script>
      <script type='text/javascript' src="js/jsoneditor.js"></script>     
      
    </head>

    <body id="page-top" data-spy="scroll" data-target=".navbar-custom" class="bg-dark">
     <div id="page-wrap">

      <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
       <div class="container">
        <div class="navbar-header page-scroll">
         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
          <i class="fa fa-bars"></i>
        </button>
        <h1 id="rDisplay"></h1>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
       <ul class="nav navbar-nav">
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- </header> -->

<section id="main-content" style="height:100%">
 <div id="guts" style="height:100%; padding-bottom:0;" class="animsition" data-animsition-in-class="zoom-in-lg"
  data-animsition-in-duration="500"
  data-animsition-out-class="fade-out-up"
  data-animsition-out-duration="300">

  <!-- Section: samples -->
  <section id="samplelist" class="home-section text-center bg-dark">
    <div class="heading-about">
    </div>
    <div class="container">
      <div class="row">
          <div class="progress">
            <div id="progress" class="progress-bar progress-bar-striped active" role="progressbar"
            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
            </div>
          </div> 
      </div>
      <div class="row">
        <div class="col-md-4"><label for="number">Review:</label></div>
        <div class="col-md-4"><input type="number" class="form-control" id="number"></div>
        <div class="col-md-4"><button id="goto" class="btn btn-default">Go to</button></div>  
      </div>
      <div class="row">
        <div class="col-sm-12 col-md-12">
          <div class="wow fadeInLeft" data-wow-delay="0.2s">
            <div class="service-box">
              <div class="service-icon">
                <img src="img/icons/list.svg" alt="" />
              </div>
              <div class="service-desc" >
                <div>
                  <input type="file" id="fileInput" class="btn btn-primary">
                </div>
                <!-- <pre id="fileDisplayArea"></pre> -->
              </div>
              <div class="panel panel-primary">
              <div class="panel-heading" style="height:200px;  overflow: scroll;"><h4 id="textDisplay"></h4></div>
              <div class="panel-body">              
                <div class="row">
                <div class="col-md-1"><strong>POS</strong></div>
                <div class="col-md-5" id="pos"></div>
                <div class="col-md-1"><strong>NEG</strong></div>
                <div class="col-md-5" id="neg"></div>
                </div>
              </div>
              </div>
              <div class="panel panel-primary">
              <div class="panel-body"> 
                  <div class="row">
                        <div class="col-xs-6">
                            <h3 class="text-center">Positive points</h3>
                            <div id="positivediv" class="well" style="max-height: 300px;overflow: auto;">
                              <ul id="check-list-pos" class="list-group checked-list-box">
                              </ul>
                            </div>
                            <!-- <pre id="display-json"></pre> -->
                        </div>
                        <div class="col-xs-6">
                            <h3 class="text-center">Negative points</h3>
                            <div id="negativediv" class="well" style="max-height: 300px;overflow: auto;">
                              <ul id="check-list-neg" class="list-group checked-list-box">
                                </ul>
                            </div>
                            <!-- <pre id="display-json"></pre> -->
                        </div>
                  </div>
                <div class="row">
                  <!-- <button class="btn btn-primary col-xs-12" id="get-checked-data">Get Checked Data</button> -->
                  <button id='submit' class="btn btn-primary col-xs-12 btn-lg" data-toggle="popover" data-trigger="hover" data-content="Next review"><span class="glyphicon glyphicon-chevron-right"></span></button>
                </div>
                <!-- <div class="row">
                  <div id="editor_holder"></div>
                </div> -->
              </div>
              <div class="panel-footer">
                
                <a id="ddl" href="#" class="btn btn-success" data-toggle="popover" data-trigger="hover" data-content="Save as..."><span class="glyphicon glyphicon-save"></span></a>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> <!-- end container-->
  </div>
</section> 
<!-- /Section: samples -->

</div>


</section><!-- /main-content -->
    </div>


    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/animsition.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="js/custom.js"></script>
    <script>
$(document).ready(function() {
  $('[data-toggle="popover"]').popover();

  $(".animsition").animsition({
    inClass: 'fade-in-down',
    outClass: 'fade-out-down',
    inDuration: 1500,
    outDuration: 800,
    linkElement: '.animsition-link',
    // e.g. linkElement: 'a:not([target="_blank"]):not([href^="#"])'
    loading: true,
    loadingParentElement: 'body', //animsition wrapper element
    loadingClass: 'animsition-loading',
    loadingInner: '', // e.g '<img src="loading.svg" />'
    timeout: false,
    timeoutCountdown: 5000,
    onLoadEvent: true,
    browser: [ 'animation-duration', '-webkit-animation-duration'],
    // "browser" option allows you to disable the "animsition" in case the css property in the array is not supported by your browser.
    // The default setting is to disable the "animsition" in a browser that does not support "animation-duration".
    overlay : false,
    overlayClass : 'animsition-overlay-slide',
    overlayParentElement : 'body',
    transition: function(url){ window.location.href = url; }
  });
});


</script>
<div class="checkbox">
  <label><input type="checkbox" value="">Option 1</label>
</div>
<script>
window.onload = function() {

  var options = [
        set0 = ['Accueil', 'Beau', 'Bien situé', 'Calme', 'Equipement', 'Propre', 'Cosy', 'Modern', 'Vue', 'Recommandation', 'Au dessus des attentes', 'Confortable', 'Experience_immersive', 'Global', 'Cadeau_d_arrivee', 'Cuisine', 'Ascenceur', 'Au_dessus_des_attentes', 'Sureté', 'Romantique', 'AC', 'Douche', 'parking', 'lumineux', 'balcon', 'séchoir', 'grand', 'guides', 'wifi', 'machine_a_laver', 'cour_interieur', 'qualite-prix', 'literie'],
        set1 = ['Bruit', 'SalleDeBainVieille', 'Façade_en_dessous_des_attentes', 'Arrivee_tardive_compliquee_pendant_les_fêtes', 'ParkingCher', 'Magasins_fermés', 'Cher', 'petit', 'cuisine petite', 'pas_séchoir_automatique', 'chauffage', 'malfamé', 'equipement', 'balcon', 'television_petite', 'vis-a-vis', 'sens_unique', 'ikea']
      ];

      function makeUL(array, targetid) {
          // Create the list element:
          // var list = document.createElement('ul');
          // list.id = "check-list-pos";
          // list.className = "list-group checked-list-box";
          var target = document.getElementById(targetid);

          for(var i = 0; i < array.length; i++) {
              // Create the list item:
              var item = document.createElement('li');

              item.className = "list-group-item";

              // Set its contents:
              item.appendChild(document.createTextNode(array[i]));

              // Add it to the list:
              target.appendChild(item);

              // $('<input />', { type: 'checkbox', id: 'pos'+i, value: name }).appendTo(target);
              // $('<label />', { 'for': 'pos'+i, text: name }).appendTo(target);
          }

          listenCheckbox();

          // Finally, return the constructed list:
          // return list;
      }


      // Add the contents of options[0] to #foo:
      // document.getElementById('positivediv').appendChild(makeUL(options[1]));
      makeUL(options[0], "check-list-pos");
      makeUL(options[1], "check-list-neg");

    var fileInput = document.getElementById('fileInput');
    var fileDisplayArea = document.getElementById('fileDisplayArea');
    var reviews = [{"text":""}];
    var json = {"status":"empty"};
    var element = document.getElementById('editor_holder');
    var totalReviews = reviews.length;
    var current = 0;
    var editor ;

    fileInput.addEventListener('change', function(e) {
      var file = fileInput.files[0];
      var textType = /json.*/;

      if (file.type.match(textType)) {
        var reader = new FileReader();

        reader.onload = function(e) {
          console.log("parsing json");
          var obj = JSON.parse(reader.result);
          console.log(obj);
          console.log("retrieving info from json");
          reviews = obj['reviews'];
          json = obj;
          totalReviews = reviews.length;
          // fileDisplayArea.innerText = JSON.stringify(reviews[current]);
          if(editor != null){
            editor.destroy();
          }
          init_editor(reviews[current]);   
        } 
        reader.readAsText(file);
        // console.log("reviews" + reviews);
      } else {
        fileDisplayArea.innerText = "File not supported!"
      }
    });


    
    function init_editor(review){
      // editor = new JSONEditor(element, {
      //     theme: 'bootstrap3',
      //     iconlib: 'fontawesome4',
      //     format: "grid",
      //     disable_collapse : true,
      //     disable_properties : true,
      //     disable_array_reorder: true,
      //     schema: {
      //           type: "object",
      //           title: "Review",
      //           properties: {
      //             pos: {
      //               "type": "array",
      //               "format": "table",
      //               "title": "pos",
      //               "uniqueItems": false,
      //               "items": {
      //                 "type": "string",
      //                 "title": "Pos",
      //                 enum: ['Equipement', 'Cosy', 'Modern', 'Vue', 'Clean', 'Recommandation', 'Au dessus des attentes', 'Confortable', 'Experience_immersive', 'Global', 'Cadeau_d_arrivé', 'Beau', 'Bien situé', 'Calme', 'View', 'Location', 'Cadeau_d_arrivee', 'Cuisine', 'Ascenceur', 'Au_dessus_des_attentes', 'Cosie', 'Ascenseur', 'Accueil', 'Sureté', 'Romantique', 'AC', 'Bien_situe', 'Douche', 'Propre', 'parking', 'safe', 'lumineux', 'balcon', 'séchoir', 'grand', 'guides', 'wifi', 'machine_a_laver', 'cour_interieur']
      //               }
      //             },
      //             neg: {
      //               "type": "array",
      //               "format": "table",
      //               "title": "neg",
      //               "uniqueItems": false,
      //               "items": {
      //                 "type": "string",
      //                 "title": "Neg",
      //                 enum: ['Bruit', 'SalleDeBainVieille', 'Façade_en_dessous_des_attentes', 'Arrivee_tardive_compliquee_pendant_les_fêtes', 'ParkingCher', 'Magasins_fermés', 'Cher', 'petit', 'cuisine petite', 'pas_séchoir_automatique', 'chauffage', 'malfamé', 'equipement', 'balcon']
      //                 }
      //             }
      //           }
      //         }
      //   });
        $("#textDisplay").text(review.text);
        $("#pos").text(JSON.stringify(review.pos));
        $("#neg").text(JSON.stringify(review.neg));
        $("#rDisplay").text("Review "+current+" / "+totalReviews);

      }

      document.getElementById('submit').addEventListener('click',function() {
        // event.preventDefault(); 
        var checkedItems = {}, posArray = [], negArray=[], counter = 0;
        $("#check-list-neg li.active").each(function(idx, li) {
            // checkedItems[counter] = $(li).text();
            negArray.push( $(li).text() );
            // counter++;
        });
        $("#check-list-pos li.active").each(function(idx, li) {
            // checkedItems[counter] = $(li).text();
            posArray.push( $(li).text() );
            // counter++;
        });
        if(posArray.length > 0){
          json['reviews'][current].pos = posArray;
        }
        if(negArray.length > 0){
          json['reviews'][current].neg = negArray;
        }


        // Get the value from the editor
        // if(editor.getValue().pos.length > 0){
        //   json['reviews'][current].pos = editor.getValue().pos;
        // }
        // if(editor.getValue().neg.length > 0){
        //   json['reviews'][current].neg = editor.getValue().neg;
        // }
        console.log(json['reviews'][current]);
        current++;
        $("#rDisplay").text("Review "+current+" / "+totalReviews);
        percent = Math.floor((current / totalReviews) * 100);
        $("#progress").css("width", percent+"%");
        // editor.destroy();
        init_editor(json['reviews'][current]);
        $('li').removeClass('active');
        $("#check-list-pos").html("");
        $("#check-list-neg").html("");
        makeUL(options[0], "check-list-pos");
      makeUL(options[1], "check-list-neg");

        update_ddl();
      });   

      function update_ddl(){
        var obj = JSON.stringify(json, null, 2);
        var blob = new Blob([obj], {type: "application/json"});
        var url  = URL.createObjectURL(blob);
        // var a = document.createElement('a');
        var ddl = document.getElementById('ddl');
        ddl.download    = "tagged.json";
        ddl.href        = url;
        ddl.textContent = "Save As";
        ddl.className = "btn btn-success";
      }

      document.getElementById('goto').addEventListener('click',function() {
        current = $("#number").val();
        $("#rDisplay").text("Review "+current+" / "+totalReviews);
        percent = Math.floor((current / totalReviews) * 100);
        $("#progress").css("width", percent+"%");
        // editor.destroy();
        init_editor(json['reviews'][current]);
        $('li').removeClass('active');
        makeUL(options[0], "check-list-pos");
      makeUL(options[1], "check-list-neg");
        update_ddl();
      });

    function listenCheckbox() {
    $('.list-group.checked-list-box .list-group-item').each(function () {
        
        // Settings
        var $widget = $(this),
            $checkbox = $('<input type="checkbox" class="hidden" />'),
            color = ($widget.data('color') ? $widget.data('color') : "primary"),
            style = ($widget.data('style') == "button" ? "btn-" : "list-group-item-"),
            settings = {
                on: {
                    icon: 'glyphicon glyphicon-check'
                },
                off: {
                    icon: 'glyphicon glyphicon-unchecked'
                }
            };
            
        $widget.css('cursor', 'pointer')
        $widget.append($checkbox);

        // Event Handlers
        $widget.on('click', function () {
            $checkbox.prop('checked', !$checkbox.is(':checked'));
            $checkbox.triggerHandler('change');
            updateDisplay();
        });
        $checkbox.on('change', function () {
            updateDisplay();
        });
          

        // Actions
        function updateDisplay() {
            var isChecked = $checkbox.is(':checked');

            // Set the button's state
            $widget.data('state', (isChecked) ? "on" : "off");

            // Set the button's icon
            $widget.find('.state-icon')
                .removeClass()
                .addClass('state-icon ' + settings[$widget.data('state')].icon);

            // Update the button's color
            if (isChecked) {
                $widget.addClass(style + color + ' active');
            } else {
                $widget.removeClass(style + color + ' active');
            }
        }

        // Initialization
        function init() {
            
            if ($widget.data('checked') == true) {
                $checkbox.prop('checked', !$checkbox.is(':checked'));
            }
            
            updateDisplay();

            // Inject the icon if applicable
            if ($widget.find('.state-icon').length == 0) {
                $widget.prepend('<span class="state-icon ' + settings[$widget.data('state')].icon + '"></span>');
            }
        }
        init();
    });
    
    $('#get-checked-data').on('click', function(event) {
        event.preventDefault(); 
        var checkedItems = {}, posArray = [], negArray=[], counter = 0;
        $("#check-list-neg li.active").each(function(idx, li) {
            // checkedItems[counter] = $(li).text();
            negArray.push( $(li).text() );
            // counter++;
        });
        $("#check-list-pos li.active").each(function(idx, li) {
            // checkedItems[counter] = $(li).text();
            posArray.push( $(li).text() );
            // counter++;
        });
        json['reviews'][current].pos = posArray;
        json['reviews'][current].neg = negArray;
        $('#display-json').html(JSON.stringify(json['reviews'][current], null, '\t'));
    });
  }
      
}



</script>
<link href="css/style.css" rel="stylesheet" type="text/css"/>
<style>
  /* list check box */
/* CSS REQUIRED */
.state-icon {
    left: -5px;
}
.list-group-item-primary {
    color: rgb(255, 255, 255);
    background-color: rgb(66, 139, 202);
}

/* DEMO ONLY - REMOVES UNWANTED MARGIN */
.well .list-group {
    margin-bottom: 0px;
}
/* ./ list check box */
</style>

</body>

</html>